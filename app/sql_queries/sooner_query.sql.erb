select users.name,groups.name group_name,s.user_id,s.created_at,
case when s.check_in_date=1 then s.early  end day1,
case when s.check_in_date=2 then s.early  end day2,
case when s.check_in_date=3 then s.early  end day3,
case when s.check_in_date=4 then s.early  end day4,
case when s.check_in_date=5 then s.early  end day5,
case when s.check_in_date=6 then s.early  end day6,
case when s.check_in_date=7 then s.early  end day7,
case when s.check_in_date=8 then s.early  end day8,
case when s.check_in_date=9 then s.early  end day9,
case when s.check_in_date=10 then s.early  end day10,
case when s.check_in_date=11 then s.early  end day11,
case when s.check_in_date=12 then s.early  end day12,
case when s.check_in_date=13 then s.early  end day13,
case when s.check_in_date=14 then s.early  end day14,
case when s.check_in_date=15 then s.early  end day15,
case when s.check_in_date=16 then s.early  end day16,
case when s.check_in_date=17 then s.early  end day17,
case when s.check_in_date=18 then s.early  end day18,
case when s.check_in_date=19 then s.early  end day19,
case when s.check_in_date=20 then s.early  end day20,
case when s.check_in_date=21 then s.early  end day21,
case when s.check_in_date=22 then s.early  end day22,
case when s.check_in_date=23 then s.early  end day23,
case when s.check_in_date=24 then s.early  end day24,
case when s.check_in_date=25 then s.early  end day25,
case when s.check_in_date=26 then s.early  end day26,
case when s.check_in_date=27 then s.early  end day27,
case when s.check_in_date=28 then s.early  end day28,
case when s.check_in_date=29 then s.early  end day29,
case when s.check_in_date=30 then s.early  end day30,
case when s.check_in_date=31 then s.early  end day31

from (
select s1.user_id,s1.created_at, date_part('day',s1.check_in_date) check_in_date ,case when s1.check_in_time < 7.5 then round(cast(s1.check_out_time-7.5 as numeric),2) end as early
from (
Select a.user_id, a.created_at,a.created_at check_in_date, date_part('hour', a.created_at) + round(CAST((date_part('minute', a.created_at)/60) as numeric),2) check_in_time, date_part('hour', b.created_at) + round( CAST((date_part('minute', b.created_at)/60) as numeric),2) check_out_time        
from check_ins a 
left outer join check_outs b on a.user_id=b.user_id and date_trunc('day',a.created_at) =date_trunc('day',b.created_at)
) s1
) s
 
left outer join day_months on 1=1
inner join users on s.user_id=users.id
inner join user_groups on s.user_id=user_groups.user_id
inner join groups on user_groups.group_id=groups.id
Where groups.id = <%= quote @group_id %> and date_part('month',s.created_at)= <%= quote @month %>
Order by groups.name,users.name