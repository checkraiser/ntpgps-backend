select users.name,groups.name group_name,s.user_id,s.created_at,
case when check_out_day=1 then s.check_out_time end day1,
case when check_out_day=2 then s.check_out_time end day2,
case when check_out_day=3 then s.check_out_time end day3,
case when check_out_day=4 then s.check_out_time end day4,
case when check_out_day=5 then s.check_out_time end day5,
case when check_out_day=6 then s.check_out_time end day6,
case when check_out_day=7 then s.check_out_time end day7,
case when check_out_day=8 then s.check_out_time end day8,
case when check_out_day=9 then s.check_out_time end day9,
case when check_out_day=10 then s.check_out_time end day10,
case when check_out_day=11 then s.check_out_time end day11,
case when check_out_day=12 then s.check_out_time end day12,
case when check_out_day=13 then s.check_out_time end day13,
case when check_out_day=14 then s.check_out_time end day14,
case when check_out_day=15 then s.check_out_time end day15,
case when check_out_day=16 then s.check_out_time end day16,
case when check_out_day=17 then s.check_out_time end day17,
case when check_out_day=18 then s.check_out_time end day18,
case when check_out_day=19 then s.check_out_time end day19,
case when check_out_day=20 then s.check_out_time end day20,
case when check_out_day=21 then s.check_out_time end day21,
case when check_out_day=22 then s.check_out_time end day22,
case when check_out_day=23 then s.check_out_time end day23,
case when check_out_day=24 then s.check_out_time end day24,
case when check_out_day=25 then s.check_out_time end day25,
case when check_out_day=26 then s.check_out_time end day26,
case when check_out_day=27 then s.check_out_time end day27,
case when check_out_day=28 then s.check_out_time end day28,
case when check_out_day=29 then s.check_out_time end day29,
case when check_out_day=30 then s.check_out_time end day30,
case when check_out_day=31 then s.check_out_time end day31     
from (
select a.user_id,a.created_at,date_part('day', b.created_at) check_out_day, date_part('hour', b.created_at) + round(CAST((date_part('minute', b.created_at)/60) as numeric),2) check_out_time
from check_ins a
left outer join check_outs b on a.user_id=b.user_id and date_trunc('day',a.created_at) =date_trunc('day',b.created_at)
) s
left outer join day_months on 1=1 
inner join users on s.user_id=users.id
inner join user_groups on s.user_id=user_groups.user_id
inner join groups on user_groups.group_id=groups.id
Where groups.id = <%= quote @group_id %> and date_part('month',s.created_at)= <%= quote @month %>
Order by groups.name,users.name 