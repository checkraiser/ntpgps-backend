<% if logged_in? %>
<div style='width: 800px;'>
  <div id="map" style='width: 1000px; height: 400px;'></div>
</div>

<div id="log">
</div>
 <script src="https://maps.google.com/maps/api/js?key=AIzaSyDC_f7OaJMYMK92QjscI1B8Jo9U_33bBhQ"></script>
<script src="https://cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='https://cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
<script>

mapHandler = Gmaps.build('Google');
mapHandler.buildMap({ provider: {
   disableDefaultUI: false,
   mapTypeId: google.maps.MapTypeId.TERRAIN
 }, internal: {id: 'map'}
}, function(){
 var markersData = <%= raw @hash.to_json %>;
 updateMarkers(mapHandler, markersData);
});

function append(id, direction){
  el =document.getElementById(id);
  el.append("<div>").append(direction).append("</div>");
}

App.messages = App.cable.subscriptions.create('LocationsChannel', { 
  received: function(data){
    updateMarkers(mapHandler, data.locations);
    append('log', data.direction);
  }
});

</script> 
<% end %>